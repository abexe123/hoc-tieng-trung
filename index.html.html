<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Luyện từ vựng tiếng Trung</title>
<style>
body {
  font-family: Arial, sans-serif;
  max-width: 520px;
  margin: 40px auto;
}
h2 {
  margin-bottom: 15px;
}
input {
  width: 100%;
  padding: 10px;
  font-size: 18px;
}
button {
  padding: 8px 16px;
  font-size: 16px;
  margin-top: 10px;
}
#result {
  margin-top: 10px;
  font-size: 18px;
  font-weight: bold;
}
.correct { color: green; }
.wrong { color: red; }
</style>
</head>

<body>

<h2 id="question">Đang tải dữ liệu...</h2>

<input
  id="answer"
  placeholder="Nhập tiếng Trung rồi nhấn Enter"
  autocomplete="off"
  autofocus
>

<div>
  <button onclick="skip()">Bỏ qua</button>
</div>

<div id="result"></div>

<script>
let vocab = [];
let current = null;

// Đọc file CSV UTF-8
fetch("vocab.csv")
  .then(res => res.text())
  .then(text => {
    vocab = text
      .trim()
      .split("\n")
      .map(line => {
        const [vi, zh] = line.split(",");
        return {
          vi: vi?.trim(),
          zh: zh?.trim()
        };
      })
      .filter(item => item.vi && item.zh);

    nextWord();
  })
  .catch(() => {
    document.getElementById("question").innerText =
      "❌ Không đọc được file vocab.csv";
  });

function randomItem() {
  return vocab[Math.floor(Math.random() * vocab.length)];
}

function nextWord() {
  current = randomItem();
  document.getElementById("question").innerText =
    "Dịch sang tiếng Trung: " + current.vi;
  document.getElementById("answer").value = "";
  document.getElementById("result").innerText = "";
  document.getElementById("answer").focus();
}

// Enter = kiểm tra
document.getElementById("answer").addEventListener("keydown", e => {
  if (e.key === "Enter") check();
});

function normalize(str) {
  return str
    .replace(/\s+/g, "")
    .replace(/[，。！？]/g, "")
    .toLowerCase();
}

function check() {
  const user = normalize(
    document.getElementById("answer").value
  );
  const correct = normalize(current.zh);

  if (!user) return;

  if (user === correct) {
    document.getElementById("result").innerHTML =
      "<span class='correct'>✅ Đúng</span>";
    setTimeout(nextWord, 800);
  } else {
    document.getElementById("result").innerHTML =
      "<span class='wrong'>❌ Sai – nhập lại</span>";
  }
}

function skip() {
  nextWord();
}
</script>

</body>
</html>
