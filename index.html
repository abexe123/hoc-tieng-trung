<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Luyện từ vựng tiếng Trung</title>

<style>
body {
  font-family: Arial, sans-serif;
  max-width: 520px;
  margin: 40px auto;
}
h2 { margin-bottom: 12px; }
input {
  width: 100%;
  padding: 10px;
  font-size: 18px;
}
button {
  padding: 8px 16px;
  font-size: 16px;
  margin-top: 10px;
}
#result {
  margin-top: 10px;
  font-size: 18px;
  font-weight: bold;
}
.correct { color: green; }
.wrong { color: red; }
</style>
</head>

<body>

<h2 id="question">Đang tải dữ liệu…</h2>

<input
  id="answer"
  placeholder="Nhập tiếng Trung rồi nhấn Enter"
  autocomplete="off"
  autofocus
>

<div>
  <button onclick="skip()">Bỏ qua</button>
</div>

<div id="result"></div>

<script>
let vocab = [];
let current = null;

// =====================
// LOAD TSV (UTF-8)
// =====================
fetch("vocab.tsv")
  .then(r => r.text())
  .then(text => {
    const lines = text.split(/\r?\n/);

    vocab = lines.map(line => {
      if (!line.includes("\t")) return null;

      const [vi, zh] = line.split("\t");

      if (
        !vi || !zh ||
        vi.includes("<") ||
        zh.includes("<") ||
        vi.includes("base64") ||
        zh.includes("base64")
      ) return null;

      return {
        vi: vi.trim(),
        zh: zh.trim()
      };
    }).filter(Boolean);

    console.log("Số từ load được:", vocab.length);

    if (vocab.length === 0) {
      document.getElementById("question").innerText =
        "❌ Không có dữ liệu hợp lệ trong vocab.tsv";
      return;
    }

    nextWord();
  })
  .catch(err => {
    document.getElementById("question").innerText =
      "❌ Không đọc được vocab.tsv";
    console.error(err);
  });

// =====================
// RANDOM
// =====================
function randomItem() {
  return vocab[Math.floor(Math.random() * vocab.length)];
}

function nextWord() {
  current = randomItem();
  document.getElementById("question").innerText =
    "Dịch sang tiếng Trung: " + current.vi;
  document.getElementById("answer").value = "";
  document.getElementById("result").innerText = "";
  document.getElementById("answer").focus();
}

// =====================
// ENTER = CHECK
// =====================
document.getElementById("answer").addEventListener("keydown", e => {
  if (e.key === "Enter") check();
});

// =====================
// SO SÁNH
// =====================
function normalize(str) {
  return str
    .replace(/\s+/g, "")
    .replace(/[，。！？,.!?]/g, "")
    .toLowerCase();
}

function check() {
  const user = normalize(
    document.getElementById("answer").value
  );
  const correct = normalize(current.zh);

  if (!user) return;

  if (user === correct) {
    document.getElementById("result").innerHTML =
      "<span class='correct'>✅ Đúng</span>";
    setTimeout(nextWord, 700);
  } else {
    document.getElementById("result").innerHTML =
      "<span class='wrong'>❌ Sai – nhập lại</span>";
  }
}

// =====================
// SKIP
// =====================
function skip() {
  nextWord();
}
</script>

</body>
</html>
